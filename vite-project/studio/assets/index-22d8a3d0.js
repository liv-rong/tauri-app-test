import{r as o,f as A,u as N,A as y,j as e,B as i}from"./index-626914f7.js";import{u}from"./canvas-0ce26167.js";import{u as R}from"./shallow-960f8f40.js";import{h as T}from"./index-204389a5.js";import{a as C}from"./index.esm-0b9baea5.js";import{T as b}from"./index-7327046a.js";import{A as j}from"./AntdIcon-8f254c60.js";import{I as L}from"./index-ddaf4d43.js";import{L as S}from"./LoadingOutlined-a5ef3b13.js";var z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"};const I=z;function x(){return x=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},x.apply(this,arguments)}const E=(a,t)=>o.createElement(j,x({},a,{ref:t,icon:I})),P=o.forwardRef(E),$=P;var M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M848 359.3H627.7L825.8 109c4.1-5.3.4-13-6.3-13H436c-2.8 0-5.5 1.5-6.9 4L170 547.5c-3.1 5.3.7 12 6.9 12h174.4l-89.4 357.6c-1.9 7.8 7.5 13.3 13.3 7.7L853.5 373c5.2-4.9 1.7-13.7-5.5-13.7zM378.2 732.5l60.3-241H281.1l189.6-327.4h224.6L487 427.4h211L378.2 732.5z"}}]},name:"thunderbolt",theme:"outlined"};const _=M;function h(){return h=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(a[r]=s[r])}return a},h.apply(this,arguments)}const k=(a,t)=>o.createElement(j,h({},a,{ref:t,icon:_})),B=o.forwardRef(k),H=B,Q=()=>{const[a,t]=o.useState(!1),s=o.useRef(null),{outline:r}=u(R(l=>({outline:l.outline}))),p=o.useRef(null),d=A(),g=N(),{message:c}=y.useApp(),v=()=>{m()},w=()=>{var n,f;const l=(f=(n=p.current)==null?void 0:n.resizableTextArea)==null?void 0:f.textArea;l&&(l.scrollTop=l.scrollHeight)},m=()=>{if(a)return;let l="";s.current&&s.current.abort(),s.current=new AbortController,t(!0),T({abortController:s.current,token:C,body:{response_mode:"streaming",query:u.getState().title||"",inputs:{}},onMessage:n=>{const f=(n==null?void 0:n.answer)||"";l=l+f,u.setState({outline:l}),w()},onClose:()=>{c.success("流式生成完成"),t(!1),u.setState({outline:l})},onError:n=>{t(!1),c.error(typeof n=="string"?n:(n==null?void 0:n.message)||"生成失败")}})},O=()=>{s.current&&s.current.abort(),t(!1),c.info("请求已取消")};return o.useEffect(()=>{var n;return((n=g.state)==null?void 0:n.auto)&&(d(g.pathname,{replace:!0,state:{}}),m()),()=>{s.current&&s.current.abort()}},[]),e.jsxs("div",{className:"flex size-full flex-col items-center justify-start bg-gray-50",children:[e.jsx("div",{className:"flex w-full items-center justify-center border-b bg-white py-2",children:e.jsxs("div",{className:"flex w-full max-w-5xl items-center justify-between gap-2",children:[e.jsx(i,{onClick:()=>d("/"),className:"flex items-center rounded-md",children:"返回首页"}),e.jsx("span",{className:"text-lg font-semibold",children:"PPT大纲"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{type:"primary",onClick:()=>{if(!r){c.info("请输入大纲");return}d("/template")},className:"flex items-center rounded-md",children:"选择模版"}),e.jsx(b,{title:"重新生成大纲",children:e.jsx(i,{icon:e.jsx($,{}),shape:"circle",size:"small",onClick:v,loading:a,className:"ml-2"})}),e.jsx(b,{title:"AI智能生成",children:e.jsx(i,{icon:e.jsx(H,{}),shape:"circle",size:"small",className:"ml-2",onClick:()=>{if(!r){c.info("请输入或粘贴 Markdown 内容");return}m()}})})]})]})}),e.jsxs("div",{className:"flex h-[calc(100vh-64px)] w-full max-w-5xl flex-col rounded-md bg-white p-6",children:[e.jsx(L.TextArea,{ref:p,value:r,onChange:l=>{u.setState({outline:l.target.value})},placeholder:"请输入PPT大纲内容...",autoSize:!1,rows:1,maxLength:2e3,className:"h-full flex-1 resize-none !text-base"}),a&&e.jsxs("div",{className:"absolute inset-0 flex size-full flex-col items-center justify-center gap-5 bg-gray-500/20",children:[e.jsx(S,{className:"text-6xl text-[#eab308]"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("span",{className:"text-lg font-medium text-white",children:"AI正在生成大纲..."}),e.jsx(i,{type:"default",onClick:O,children:"取消生成"})]})]})]})]})};export{Q as default};
