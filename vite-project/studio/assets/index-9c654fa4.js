import{A as pt,r as P,u as gt,j as W,B as ut}from"./index-626914f7.js";import{c as j,u as xt,H as dt,O as yt,m as vt,T as wt,C as Ht,F as bt,a as Yt}from"./CanvasWithOverflow-d49fd917.js";import{v as h,C as M,u as G}from"./canvas-0ce26167.js";import{u as Xt}from"./shallow-960f8f40.js";import{h as St}from"./index-204389a5.js";import{A as Lt}from"./index.esm-0b9baea5.js";import{P as S,s as Ct,t as At}from"./index-383ddd63.js";import{L as zt}from"./LoadingOutlined-a5ef3b13.js";import"./BaseSelectComp-10db33f3.js";import"./index-7327046a.js";import"./index-ddaf4d43.js";import"./AntdIcon-8f254c60.js";function U(r){return(r||"").replace(/\r/g,"").replace(/\s*chunks\s*$/i,"").trim()}function Tt(r){const t=[];for(const n of r){const i=n.match(/^\s*-\s+(.*)$/);i&&t.push(i[1].trim())}return t}function Wt(r){const t=[];for(const n of r){const i=n.trim();let s=i.match(/^\d+\.\s+\*\*(.+?)\*\*\s*[-：:]\s*(.+)$/);if(s){t.push({title:s[1].trim(),text:s[2].trim()});continue}let e=i.match(/^\d+\.\s+\*\*(.+?)\*\*\s*$/);if(e){t.push({title:e[1].trim()});continue}let c=i.match(/^\*\*(.+?)\*\*\s*[-：:]\s*(.+)$/);if(c){t.push({title:c[1].trim(),text:c[2].trim()});continue}let f=i.match(/^\*\*(.+?)\*\*\s*$/);if(f){t.push({title:f[1].trim()});continue}}return t}function nt(r){var f,v,a;const t=U(r);if(!t)return[];const n=/\n---\n/.test(t),i=t.split(`
`),s=[];if(n)s.push(...t.split(/\n---\n/g));else{let g=[];for(const l of i)/^#\s+/.test(l)||/^##\s+/.test(l)||/^###\s+/.test(l)||/^####\s+/.test(l)?(g.length&&s.push(g.join(`
`)),g=[l]):g.push(l);g.length&&s.push(g.join(`
`))}const e=[],c=g=>{const l=[];for(let o=0;o<g.length;o++){const u=g[o].match(/^\s*-\s+(.+)$/);if(u){const y=u[1].trim();let p;const A=(o+1<g.length?g[o+1]:"").match(/^\s{2,}-\s+(.+)$/);A&&(p=A[1].trim(),o++),y&&l.push({title:y,...p?{text:p}:{}})}}return l};for(const g of s){const l=U(g);if(!l)continue;const o=l.split(`
`),w=o.find(u=>/^#\s+/.test(u)||/^##\s+/.test(u)||/^###\s+/.test(u)||/^####\s+/.test(u))||"";if(/^#\s+/.test(w)&&!/谢谢观看/.test(w)){const u=w.replace(/^#\s+/,"").trim();let y="";const p=o.findIndex(b=>/^#\s+/.test(b));if(p>=0){const b=((f=o[p+1])==null?void 0:f.trim())||"";/^-\s+/.test(b)?y=b.replace(/^-\s+/,"").trim():b&&!/^#/.test(b)&&(y=b)}e.push({type:"cover",data:{title:u,...y?{text:y}:{}}});continue}if(/^##\s*目录页/.test(w)){const u=Tt(o);e.push({type:"contents",data:{items:u}});continue}if(/^###\s+/.test(w)){const u=w.replace(/^###\s+/,"").trim();let y="";const p=o.findIndex(b=>/^###\s+/.test(b));if(p>=0){const b=((v=o[p+1])==null?void 0:v.trim())||"";/^-\s+/.test(b)?y=b.replace(/^-\s+/,"").trim():b&&!/^#/.test(b)&&(y=b)}e.push({type:"transition",data:{title:u,...y?{text:y}:{}}});continue}if(/^####\s+/.test(w)){const u=w.replace(/^####\s+/,"").trim(),y=o.slice(o.findIndex(A=>/^####\s+/.test(A))+1),p=c(y),b=(p.length?p:Wt(y)).slice(0,4);e.push({type:"content",data:{title:u,items:b}});continue}if(/^#+\s*谢谢观看/.test(w)){const u="谢谢观看";let y="";const p=o.findIndex(b=>/^#+\s*谢谢观看/.test(b));if(p>=0){const b=((a=o[p+1])==null?void 0:a.trim())||"";b&&!/^#/.test(b)&&(y=b)}e.push({type:"end",data:{title:u,...y?{text:y}:{}}});continue}}return e}function Bt(r){const t=U(r);if(!t)return{sections:[],rest:""};if(/\n---\n/.test(t)){const f=t.split(/\n---\n/g),v=f.slice(0,-1).filter(Boolean),a=f[f.length-1]||"";return{sections:v,rest:a}}const n=t.split(`
`),i=[];let s=[];const e=f=>/^#\s+/.test(f)||/^##\s+/.test(f)||/^###\s+/.test(f)||/^####\s+/.test(f);for(const f of n)e(f)?(s.length&&i.push(s.join(`
`)),s=[f]):s.push(f);const c=s.join(`
`);return{sections:i,rest:c}}const Q="/assets/bg1-0e35de5d.png",Gt="/assets/bg2-74839330.png",Mt="/assets/item1-9430a2d4.jpg",It="/assets/item2-b6551c47.jpg",_=(r,t=24,n=1.2,i=668)=>{if(!r)return t*n;const s={chinese:1,english:.62,space:.28,punctuation:.54},e=l=>/[\u4e00-\u9fa5]/.test(l)?"chinese":/[a-zA-Z0-9]/.test(l)?"english":/\s/.test(l)?"space":/[，。！？；：""''（）【】《》]/.test(l)||/[,.!?;:"'()\[\]<>]/.test(l)?"punctuation":"english";let c=0,f=1;for(let l=0;l<r.length;l++){const o=r[l],w=e(o),u=t*s[w];c+u>i?(f++,c=u):c+=u}const v=f*t*n;let a=0;f===1?a=3:f===2?a=6:a=8,r.length>30&&(a+=2),r.length>50&&(a+=2),t>=32&&(a+=2);const g=Math.max(0,(n-1)*t*.5);return a+=g,Math.round(v+a)},kt=(r=24,t=1.2)=>r*t,Ft=(r,t=24,n=1.2)=>{const i=kt(t,n);return r+i/2-5},H=(r,t=24,n=1.2,i=668)=>{if(!r)return t*n;const s={chinese:1,english:.8,space:.4,punctuation:.7,number:.8},e=l=>/[\u4e00-\u9fa5]/.test(l)?"chinese":/[a-zA-Z]/.test(l)?"english":/[0-9]/.test(l)?"number":/\s/.test(l)?"space":/[，。！？；：""''（）【】《》]/.test(l)||/[,.!?;:"'()\[\]<>]/.test(l)?"punctuation":"english";let c=0,f=1;for(let l=0;l<r.length;l++){const o=r[l],w=e(o),u=t*s[w];c+u>i?(f++,c=u):c+=u}const v=f*t*n;let a=0;f===1?a=8:f===2?a=12:a=18,r.length>30&&(a+=3),r.length>50&&(a+=3),t>=24&&(a+=3),t>=32&&(a+=3);const g=Math.max(0,(n-1)*t*.6);return a+=g,a+=t*.2,Math.round(v+a)},x=1.2,st=r=>{const{data:t}=r,n=H((t==null?void 0:t.title)||"",64,1.2,790.48),i=H((t==null?void 0:t.text)||"",16,1.2,794);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:3200,height:1800,scaleX:.25,scaleY:.25,src:Gt,styles:[],selectable:!1,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:5.02,top:140,width:790.48,height:n,fill:"#333",lineHeight:x,textAlign:"center",fontFamily:"Times New Roman",fontWeight:"normal",fontSize:64,styles:[],text:t==null?void 0:t.title,splitByGrapheme:!0,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:.5,top:225,width:794,lineHeight:x,height:i,fill:"#333",fontSize:16,textAlign:"center",styles:[],text:t==null?void 0:t.text,splitByGrapheme:!0,id:h()}].filter(s=>!((s==null?void 0:s.type)==="textbox"&&!(s!=null&&s.text)))},$t=r=>{const{data:t}=r,n=t.items.map((e,c)=>`${c} ${e}`).join(`
`),i=t.items.length*(24*1.5),s=(j.height-i)/2;return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:3200,height:1800,scaleX:.25,scaleY:.25,src:Q,selectable:!1,styles:[],id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:70.5,top:69,width:288,height:45.2,fill:"#333",fontSize:40,text:"目录",styles:[],lineHeight:x,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:448.5,top:s,width:358.75,height:i,fill:"#333",fontSize:24,text:n,styles:[],lineHeight:1.5,id:h()},{type:"path",version:"5.3.0",originX:"left",originY:"top",left:399,top:116,width:200,height:200,fill:"#d7a89a",strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[],scaleX:.01,scaleY:1.09,id:h()}].filter(e=>!((e==null?void 0:e.type)==="textbox"&&!(e!=null&&e.text)))},Nt=(r,t)=>{const{data:n}=r,i=H(`PART ${t||""}`,24,x,329.25),s=H(n.title,40,x,788),e=H((n==null?void 0:n.text)??"",18,x,791);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:3200,height:1800,scaleX:.25,scaleY:.25,src:Q,selectable:!1,styles:[],id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:112.25,top:25,width:329.25,lineHeight:x,height:i,fill:"#333",text:`PART ${t||""}`,styles:[],id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:1.5,top:156.9,width:788,height:s,lineHeight:x,fill:"#80937d",fontSize:40,styles:[],text:n==null?void 0:n.title,textAlign:"center",splitByGrapheme:!0,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:1.75,top:228,width:791,height:e,lineHeight:x,fill:"#333",text:n==null?void 0:n.text,styles:[],fontSize:18,textAlign:"center",splitByGrapheme:!0,id:h()}].filter(c=>!((c==null?void 0:c.type)==="textbox"&&!(c!=null&&c.text)))},Pt=r=>{const{data:t}=r,n=t==null?void 0:t.items.length;if(n===1)return Rt(r);if(n===2)return Math.random()>.5?Ot(r):Zt(r);if(n===3)return Math.random()>.5?Et(r):Jt(r);if(n===4)return Math.random()>.5?lt(r):ot(r);if(n>4){const i={...r,data:{...t,items:t.items.slice(0,4)}};return Math.random()>.5?lt(i):ot(i)}return[]},Rt=r=>{var s,e;const{data:t}=r,n=H((s=t.items[0])==null?void 0:s.title,24,x,699),i=H(((e=t.items[0])==null?void 0:e.text)??"",16,x,690);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:50,top:50.42,width:1318,height:338,src:It,scaleX:.53,scaleY:.53,styles:[],selectable:!1,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:48.75,top:244.1,width:699,lineHeight:x,height:n,fill:"#333",fontSize:24,text:t.items[0].title,styles:[],splitByGrapheme:!0,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:50.25,top:288.1,width:690,lineHeight:x,height:i,fill:"#333",fontSize:16,text:t.items[0].text,styles:[],splitByGrapheme:!0,id:h()}].filter(c=>!((c==null?void 0:c.type)==="textbox"&&!(c!=null&&c.text)))},Ot=r=>{var f,v,a,g;const{data:t}=r,n=H(t==null?void 0:t.title,36,x,706),i=H((f=t.items[0])==null?void 0:f.title,24,x,312),s=H(((v=t.items[0])==null?void 0:v.text)??"",16,x,304),e=H((a=t.items[1])==null?void 0:a.title,24,x,312),c=H(((g=t.items[1])==null?void 0:g.text)??"",16,x,304);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,width:3200,height:1800,scaleX:.25,scaleY:.25,src:Q,styles:[],id:h(),selectable:!1},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:65.75,top:44.53,width:706,height:n,fill:"#333333",fontSize:36,lineHeight:x,text:t.title,styles:[],id:h(),splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:67.5,top:134.78,width:312,lineHeight:x,height:i,fill:"#333333",fontSize:24,id:h(),text:t.items[0].title,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:66.5,top:201.95,width:304,lineHeight:x,height:s,fill:"#333333",fontSize:16,id:h(),text:t.items[0].text,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:429.5,top:134.78,width:312,lineHeight:x,height:e,fill:"#333333",fontSize:24,id:h(),text:t.items[1].title,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:431.5,top:200.61,width:304,id:h(),lineHeight:x,height:c,fill:"#333333",fontSize:16,text:t.items[1].text,styles:[],splitByGrapheme:!0}].filter(l=>!((l==null?void 0:l.type)==="textbox"&&!(l!=null&&l.text)))},Zt=r=>{var f,v;const{data:t}=r,n=H(t.title,36,x,706),i=H(t==null?void 0:t.items[0].title,24,x,288),s=H(((f=t==null?void 0:t.items[0])==null?void 0:f.text)??"",16,x,277),e=H(t==null?void 0:t.items[1].title,24,x,288),c=H(((v=t==null?void 0:t.items[1])==null?void 0:v.text)??"",16,x,277);return[{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:61.75,top:55.53,width:706,id:h(),height:n,lineHeight:x,fill:"#d7a89a",fontSize:36,text:t.title,styles:[],splitByGrapheme:!0},{type:"path",version:"5.3.0",originX:"left",originY:"top",left:53.5,top:162.5,width:200,id:h(),height:200,fill:"#f5f5f5",scaleX:1.6,scaleY:1.08,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:72.5,top:172.61,id:h(),width:288,lineHeight:x,height:i,fill:"#333",fontSize:24,text:t==null?void 0:t.items[0].title,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:77.5,id:h(),top:222.61,width:277,lineHeight:x,height:s,fill:"#333",fontSize:16,text:t==null?void 0:t.items[0].text,styles:[],splitByGrapheme:!0},{type:"path",version:"5.3.0",originX:"left",originY:"top",left:50.5,top:57.5,width:200,height:200,fill:"#d7a89a",id:h(),scaleX:.01,scaleY:.17,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[],splitByGrapheme:!0},{type:"path",version:"5.3.0",originX:"left",originY:"top",left:436.5,top:161.04,width:200,height:200,fill:"#f5f5f5",id:h(),scaleX:1.6,scaleY:1.08,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:455.5,top:171.15,width:288,id:h(),lineHeight:x,height:e,fill:"#333",fontSize:24,text:t==null?void 0:t.items[1].title,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:460.5,top:220.15,id:h(),width:277,lineHeight:x,height:c,fill:"#333",fontSize:16,text:t==null?void 0:t.items[1].text,styles:[],splitByGrapheme:!0}].filter(a=>!((a==null?void 0:a.type)==="textbox"&&!(a!=null&&a.text)))},Et=r=>{const{data:t}=r;let n=103.5;const i=85.5,s=t.items.map((e,c)=>{const f=_((e==null?void 0:e.title)||"",24,x,668),v=_((e==null?void 0:e.text)||"",16,x,648),a=f+v+8,g=n;return n=n+a+20,[{type:"path",version:"5.3.0",originX:"left",originY:"top",id:h(),left:i-20,top:Ft(g,24,1.2),width:200,height:200,fill:"#d7a89a",scaleX:.05,scaleY:.05,data:"circle",strokeWidth:0,path:[["M",100,0],["C",155.22847498307934,0,200,44.77152501692063,200,99.99999999999997],["C",200,155.2284749830793,155.22847498307937,199.99999999999997,100.00000000000003,200],["C",44.771525016920656,200,0,155.22847498307934,0,100],["C",0,44.77152501692066,44.771525016920656,0,100,0],["Z"]],styles:[]},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",id:h(),left:i,top:g,width:668,lineHeight:x,height:f,fill:"#333333",fontSize:24,text:e==null?void 0:e.title,styles:[],splitByGrapheme:!0},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",id:h(),lineHeight:x,left:i+1,top:g+f+8,width:648,height:v,fill:"#666666",fontSize:16,text:e==null?void 0:e.text,styles:[],splitByGrapheme:!0}].filter(l=>!((l==null?void 0:l.type)==="textbox"&&!(l!=null&&l.text)))}).flat();return[{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:81.75,top:15.08,width:706,height:40.68,id:h(),lineHeight:x,fill:"#333",fontSize:36,text:t.title,styles:[],splitByGrapheme:!0},{type:"path",version:"5.3.0",originX:"left",originY:"top",left:21.25,top:19.92,width:200,height:200,id:h(),fill:"#d7a89a",strokeWidth:0,scaleX:.21,scaleY:.16,data:"parallelogram",path:[["M",50,0],["L",200,0],["L",150,200],["L",0,200],["L",50,0],["Z"]],styles:[]},...s]},Jt=r=>{const{data:t}=r,n=100,i=12,s=454,e=302,c=.54,f=20,v=t.items.map((a,g)=>{const l=_((a==null?void 0:a.title)||"",24,x,242),o=_((a==null?void 0:a.text)||"",16,x,231),w=i+g*(s*c+f),u=w+(s*c-242)/2,y=w+(s*c-231)/2;return[{type:"image",id:h(),version:"5.3.0",originX:"left",originY:"top",left:w,top:n,width:s,height:e,scaleX:c,scaleY:c,src:Mt,styles:[]},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:u,lineHeight:x,top:n+e*c+8,width:242,height:l,fill:"#333",fontSize:24,text:a.title,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:y,lineHeight:x,top:n+e*c+8+l+8,width:231,height:o,fill:"#333",fontSize:16,text:a==null?void 0:a.text,styles:[],splitByGrapheme:!0,textAlign:"center"}].filter(p=>!((p==null?void 0:p.type)==="textbox"&&!(p!=null&&p.text)))}).flat();return[{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:6.13,top:15.5,width:792,height:40.68,fill:"#d7a89a",lineHeight:x,fontSize:36,text:t.title,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"path",version:"5.3.0",originX:"left",originY:"top",left:321.7,top:64.4,width:200,height:200,fill:"#d7a89a",scaleX:.78,scaleY:.01,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},...v]},lt=r=>{const{data:t}=r,n=H(t.title,40,x,791),i=135,s=12.5,e=180,c=20,f=200,v=200,a=.9,g=1.35,l=22,o=16,w=172,u=172,y=t.items.map((p,b)=>{const A=H((p==null?void 0:p.title)||"",l,x,w),R=H((p==null?void 0:p.text)||"",o,x,u),z=s+b*(e+c),d=z+(e-f*a)/2,C=z+(e-w)/2,I=z+(e-u)/2,k="#f2f2f2",Y="#333";return[{id:h(),type:"path",version:"5.3.0",originX:"left",originY:"top",left:d,top:i,width:f,height:v,fill:k,scaleX:a,scaleY:g,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",lineHeight:x,left:C,top:i+7,width:w,height:A,fill:Y,fontSize:l,text:p==null?void 0:p.title,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",lineHeight:x,left:I,top:i+7+A+7,width:u,height:R,fill:Y,fontSize:o,text:p==null?void 0:p.text,styles:[],splitByGrapheme:!0,textAlign:"center"}].filter(X=>!((X==null?void 0:X.type)==="textbox"&&!(X!=null&&X.text)))}).flat();return[{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:3.5,top:35,width:791,lineHeight:x,height:n,fill:"#d7a89a",fontSize:40,text:t.title,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"path",version:"5.3.0",originX:"left",originY:"top",left:242.75,top:91.8,width:200,height:200,fill:"#d7a89a",scaleX:1.56,scaleY:.01,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},...y]},ot=r=>{const{data:t}=r,n=H(t.title,40,x,791),i=140,s=10,e=180,c=20,f=200,v=200,a=.96,g=1.35,l=22,o=16,w=186.75,u=186.75,y=t.items.map((p,b)=>{const A=H((p==null?void 0:p.title)||"",l,x,w),R=H((p==null?void 0:p.text)||"",o,x,u),z=s+b*(e+c),d=z+(e-f*a)/2,C=z+(e-w)/2,I=z+(e-u)/2,k=b%2===0?"#d7a89a":"#80937d",Y="#ffffff";return[{id:h(),type:"path",version:"5.3.0",originX:"left",originY:"top",left:d,top:i,width:f,height:v,fill:k,scaleX:a,scaleY:g,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",lineHeight:x,left:C,top:i+5,width:w,height:A,fill:Y,fontSize:l,text:p==null?void 0:p.title,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",lineHeight:x,left:I,top:i+5+A+5,width:u,height:R,fill:Y,fontSize:o,text:p==null?void 0:p.text,styles:[],splitByGrapheme:!0,textAlign:"center"}].filter(X=>!((X==null?void 0:X.type)==="textbox"&&!(X!=null&&X.text)))}).flat();return[{id:h(),type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:7,top:31.6,width:791,height:n,fill:"#d7a89a",fontSize:40,text:t.title,lineHeight:x,styles:[],splitByGrapheme:!0,textAlign:"center"},{id:h(),type:"path",version:"5.3.0",originX:"left",originY:"top",left:245.25,top:89.4,width:200,height:200,fill:"#d7a89a",scaleX:1.56,scaleY:.01,strokeWidth:0,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],styles:[]},...y]},Vt="/assets/图片1-eea2ca92.png",jt="/assets/bg-1-e33f0848.svg",Dt="/assets/image-0e4a353c.svg",Kt="/assets/transitionSvg-fd0128a4.svg",mt="/assets/图片7-dfa9c335.png",_t="/assets/图片6-605d9f14.png",B={styles:[],splitByGrapheme:!0,lineHeight:1.2,type:"textbox",version:"5.3.0",originX:"left",originY:"top",id:h()},rt=r=>{const{data:t}=r,{items:n}=t,i=[{left:506,top:100,width:293,height:20.34,textAlign:"left"},{left:506,top:207.49,width:293,height:20.34,textAlign:"left"},{left:508,top:313.99,width:293,height:20.34,textAlign:"left"},{left:13,top:148.99,width:293,height:20.34,textAlign:"right"},{left:9.5,top:257.99,width:293,height:20.34,textAlign:"right"}].map((s,e)=>{var a,g,l,o;const f=H((a=n[e])==null?void 0:a.title,18,L,290),v=H(((g=n[e])==null?void 0:g.text)??"",14,L,290);return[{left:s.left,top:s.top,width:290,height:f,fill:"#333333",text:(l=n[e])==null?void 0:l.title,textAlign:s.textAlign,fontSize:18,...B},{left:s.left,top:s.top+f,width:290,fill:"#333333",height:v,text:(o=n[e])==null?void 0:o.text,textAlign:s.textAlign,fontSize:14,...B}].filter(w=>!((w==null?void 0:w.type)==="textbox"&&"text"in w&&!w.text))}).flat();return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:301.03,top:137.59,width:565,height:499,scaleX:.35,scaleY:.35,styles:[],src:mt,id:h()},...i]},qt=r=>{const{data:t}=r,{items:n}=t;return[{left:49,top:120.5,id:h()},{left:417,top:120.5,id:h()},{left:48.65,top:277.67,id:h()},{left:417.65,top:277.67,id:h()}].map((s,e)=>{var a,g,l;const f=H(t.items[e].title,22,L,334),v=H(((a=t.items[e])==null?void 0:a.text)??"",14,L,334);return[{...s,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],scaleX:1.69,scaleY:.65,type:"path",version:"5.3.0",originX:"left",originY:"top",width:200,height:200,fill:"transparent",stroke:q,strokeWidth:1,style:[]},{left:s.left,top:s.top+3,width:334,height:f,fill:"#333333",text:(g=n[e])==null?void 0:g.title,textAlign:"center",fontSize:22,...B},{left:s.left,top:s.top+f/1.2,width:334,height:v,fill:"#333333",text:(l=n[e])==null?void 0:l.text,textAlign:"center",fontSize:14,...B}].filter(o=>!((o==null?void 0:o.type)==="textbox"&&"text"in o&&!o.text))}).flat()},Ut=r=>{const{data:t}=r,{items:n}=t;return[{left:49,top:120.5,id:h()},{left:417,top:120.5,id:h()},{left:48.65,top:277.67,id:h()},{left:417.65,top:277.67,id:h()}].map((s,e)=>{var a,g,l;const f=H(t.items[e].title,22,L,334),v=H(((a=t.items[e])==null?void 0:a.text)??"",14,L,334);return[{...s,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],scaleX:.01,scaleY:.55,type:"path",version:"5.3.0",originX:"left",originY:"top",width:200,height:200,fill:"#0277f0",stroke:"#0277f0",strokeWidth:0,style:[]},{left:s.left+10,top:s.top,width:334,height:f,fill:"#333333",text:(g=n[e])==null?void 0:g.title,textAlign:"left",fontSize:22,...B},{left:s.left+10,top:s.top+f/1.3,width:334,height:v,fill:"#333333",text:(l=n[e])==null?void 0:l.text,textAlign:"left",fontSize:14,...B}].filter(o=>!((o==null?void 0:o.type)==="textbox"&&"text"in o&&!o.text))}).flat()},Qt=r=>{var a,g,l;const{data:t}=r,{items:n}=t,i=22,s=14,e=200,c=[{left:279.5,top:127.5,id:h()},{left:519,top:127.5,id:h()}].map((o,w)=>{var p,b,A;const u=H(t.items[w].title,i,L,e),y=H(((p=t.items[w])==null?void 0:p.text)??"",s,L,e);return[{...o,path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]],scaleX:.01,scaleY:1.1,type:"path",version:"5.3.0",originX:"left",originY:"top",width:200,height:200,fill:"#f5f5f5",stroke:"#999",strokeWidth:0,style:[]},{left:o.left+20,top:o.top,width:e,height:u,fill:"#333333",text:(b=n[w+1])==null?void 0:b.title,textAlign:"center",fontSize:i,...B},{left:o.left+20,top:o.top+u/1.3,width:e,height:y,fill:"#333333",text:(A=n[w+1])==null?void 0:A.text,textAlign:"center",fontSize:s,...B}]}).flat(),f=H(t.items[0].title,i,L,e),v=H(((a=t.items[0])==null?void 0:a.text)??"",s,L,e);return[{left:59.5,top:127.5,width:e,height:f,fill:"#333333",text:(g=n[0])==null?void 0:g.title,textAlign:"center",fontSize:i,...B},{left:60.5,top:127.5+f/1.3,width:e,height:v,fill:"#333333",text:(l=n[0])==null?void 0:l.text,textAlign:"center",fontSize:s,...B},...c].filter(o=>!((o==null?void 0:o.type)==="textbox"&&"text"in o&&!o.text))},te=r=>{var v,a,g;const{data:t}=r,{items:n}=t,i=24,s=16,e=346.5,c=H(t.items[0].title,i,L,e),f=H(((v=t.items[0])==null?void 0:v.text)??"",s,L,e);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:503.37,top:150.31,width:757,height:505,scaleX:.3,scaleY:.3,src:_t,id:h()},{left:59.5,top:138.5,width:e,height:c,fill:"#333333",text:(a=n[0])==null?void 0:a.title,textAlign:"left",fontSize:i,...B},{left:59.5,top:138.5+c,width:e,height:f,fill:"#333333",text:(g=n[0])==null?void 0:g.text,textAlign:"left",fontSize:s,...B}].filter(l=>!((l==null?void 0:l.type)==="textbox"&&"text"in l&&!l.text))},ee=r=>{const{data:t}=r,{items:n}=t,i=24,s=16,e=666.5,c=[{left:55.75,top:118.5,id:h()},{left:55.75,top:261.99,id:h()}].map((f,v)=>{var l,o,w;const a=H(t.items[v].title,i,L,e),g=H(((l=t.items[v])==null?void 0:l.text)??"",s,L,e);return[{left:f.left,top:f.top,width:e,height:a,fill:"#333333",text:(o=n[v])==null?void 0:o.title,textAlign:"left",fontSize:i,...B},{left:f.left,top:f.top+a,width:e,height:g,fill:"#333333",text:(w=n[v])==null?void 0:w.text,textAlign:"left",fontSize:s,...B}].filter(u=>!((u==null?void 0:u.type)==="textbox"&&"text"in u&&!u.text))}).flat();return[{type:"path",version:"5.3.0",originX:"left",originY:"top",left:54.17,top:239.63,width:200,height:200,fill:q,stroke:"#999",strokeWidth:0,scaleX:3.37,scaleY:.01,id:h(),path:[["M",0,0],["L",200,0],["L",200,200],["L",0,200],["Z"]]},...c]},L=1.2,q="#0277f0",ie=()=>({type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,width:800,height:450,src:jt,styles:[],selectable:!1,data:"bg",id:h()}),ne=r=>({type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:54,top:49,width:744,height:40.68,fontSize:40,fill:"#333333",styles:[],text:r,id:h()}),at=r=>{const{data:t}=r,n=H((t==null?void 0:t.title)||"",64,1.2,790.48),i=H((t==null?void 0:t.text)||"",16,1.2,794);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:2005,height:1132,scaleX:.4,scaleY:.4,src:Vt,styles:[],selectable:!1,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:5.02,top:140,width:790.48,height:n,fill:q,lineHeight:L,textAlign:"center",fontFamily:"Times New Roman",fontWeight:"normal",fontSize:64,styles:[],text:t==null?void 0:t.title,splitByGrapheme:!0,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:.5,top:225,width:794,lineHeight:L,height:i,fill:"#333333",fontSize:16,textAlign:"center",styles:[],text:t==null?void 0:t.text,splitByGrapheme:!0,id:h()}].filter(s=>!((s==null?void 0:s.type)==="textbox"&&!(s!=null&&s.text)))},se=r=>{const{data:t}=r,n=t.items.map((e,c)=>`${c} ${e}`).join(`
`),i=t.items.length*(24*1.5),s=(j.height-i)/2;return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:800,height:450,scaleX:1,scaleY:1,src:Dt,selectable:!1,styles:[],id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:41.5,top:44,width:689.5,height:45.2,textAlign:"center",fill:"#333333",fontSize:40,text:"目录",styles:[],lineHeight:L,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:246.5,width:358.75,top:s,height:i,fill:"#333333",fontSize:24,text:n,styles:[],lineHeight:1.5,id:h()}].filter(e=>!((e==null?void 0:e.type)==="textbox"&&!(e!=null&&e.text)))},le=(r,t)=>{const{data:n}=r,i=H(n.title,40,L,j.width/2),s=H((n==null?void 0:n.text)??"",18,L,j.width/2);return[{type:"image",version:"5.3.0",originX:"left",originY:"top",left:0,top:0,data:"bg",width:800,height:450,src:Kt,selectable:!1,styles:[],id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:30,top:156.9,width:j.width/2,height:i,lineHeight:L,fill:q,fontSize:40,styles:[],text:n.title,textAlign:"left",splitByGrapheme:!0,id:h()},{type:"textbox",version:"5.3.0",originX:"left",originY:"top",left:30,top:156.9+i,width:j.width/2,height:s,lineHeight:L,fill:"#333333",text:n.text,styles:[],fontSize:18,textAlign:"left",splitByGrapheme:!0,id:h()}].filter(e=>!((e==null?void 0:e.type)==="textbox"&&!(e!=null&&e.text)))},oe=r=>{var s;const{data:t}=r,n=t==null?void 0:t.items.length,i=[];if(i.push(ie()),i.push(ne((s=r.data)==null?void 0:s.title)),n===1&&i.push(...te(r)),n===2&&i.push(...ee(r)),n===3&&i.push(...Qt(r)),n===4&&(Math.random()>.5?i.push(...Ut(r)):i.push(...qt(r))),n===5&&i.push(...rt(r)),n>5){const e={...r,data:{...t,items:t.items.slice(0,5)}};i.push(...rt(e))}return i},ft=(r,t="2")=>{const n=[];return r.forEach((i,s)=>{let e=[];const c=h(),f=`画布${s}`,v=t==="1";i.type===S.Cover?e=(v?st:at)(i):i.type===S.Contents?e=(v?$t:se)(i):i.type===S.Transition?e=(v?Nt:le)(i):i.type===S.Content?e=(v?Pt:oe)(i):e=(v?st:at)(i),e.length>0&&n.push({objects:e,id:c,title:f})}),n},ct=(r,t)=>{if(r<=0)return null;const n=Ct[r],i=t.get(n);if(i&&i.length>0)return{temp:i,title:n};{const s=ct(r-1,t);if(s&&s.temp&&s.temp.length>0)return{temp:s.temp,title:s.title}}return null},ht=(r,t)=>{const n=[];return r.forEach(i=>{let s=[];const e=h();let c=i.type;if(i.type===S.Content){const l=i.data.items.length;l===1&&(c=S.ContentsOne),l===2&&(c=S.ContentsTwo),l===3&&(c=S.ContentsThree),l===4&&(c=S.ContentsFour)}let f=t.get(c);if(i.type===S.Content&&(!f||Array.isArray(f)&&f.length<=0)){const l=i.data.items.length,o=ct(l,t);o&&(f=o.temp,c=o.title)}if(!f||f.length<=0)return;const a=Math.floor(Math.random()*f.length),g=f[a];if(g){if(i.type===S.Cover||i.type===S.End)try{s=JSON.parse(g).objects.map(o=>{if(o.type==="textbox"){if("text"in o&&(o==null?void 0:o.data)===M.H1)return{...o,text:i.data.title};if("text"in o&&(o==null?void 0:o.data)===M.P)return{...o,text:i.data.text}}return o}).filter(o=>!(o.type==="textbox"&&!o.text))}catch{return}else if(i.type===S.Contents){let l;try{l=JSON.parse(g).objects}catch{return}const o=l.filter(y=>y.type==="textbox"&&"text"in y&&y.data===M.H2),w=Math.min(i.data.items.length,o.length);let u=0;s=l.map(y=>{if(y.type==="textbox"&&"text"in y&&y.data===M.H2){if(u>=w)return null;const p={...y,text:`${u+1}. ${i.data.items[u]}`};return u++,p}return y}).filter(y=>!(y===null||y.type==="textbox"&&!y.text))}else if(i.type===S.Transition)try{s=JSON.parse(g).objects.map(o=>{if(o.type==="textbox"){if("text"in o&&o.data===M.H1)return{...o,text:i.data.title};if("text"in o&&o.data===M.P)return{...o,text:i.data.text}}return o}).filter(o=>!(o.type==="textbox"&&!o.text))}catch{return}else if(i.type===S.Content){let l;try{l=JSON.parse(g).objects}catch{return}const o={},w=[],u=[];l.forEach(d=>{d&&d.id&&(o[d.id]=d),(d==null?void 0:d.type)==="textbox"&&d.data===M.H2&&w.push(d),(d==null?void 0:d.type)==="textbox"&&d.data===M.P&&u.push(d)});const y=new Set,p=[];w.forEach(d=>{let C=null;d.linkId&&o[d.linkId]&&o[d.linkId].data===M.P?(C=o[d.linkId],y.add(C.id)):(C=u.find(I=>!y.has(I.id)&&I.linkId===d.id)||null,C&&y.add(C.id)),p.push({h2:d,p:C})}),u.forEach(d=>{y.has(d.id)||p.push({h2:null,p:d})});const b=i.data.items,A=Math.min(b.length,p.length),R=new Map,z=new Map;for(let d=0;d<A;d++){const C=p[d];C.h2&&R.set(C.h2.id,d),C.p&&z.set(C.p.id,d)}s=l.map(d=>{var C,I;if((d==null?void 0:d.type)==="textbox"){if(d.data===M.H2){const k=R.get(d.id);return k===void 0?null:{...d,text:((C=b[k])==null?void 0:C.title)||""}}if(d.data===M.P){const k=z.get(d.id);return k===void 0?null:{...d,text:((I=b[k])==null?void 0:I.text)||""}}if(d.data===M.H1)return{...d,text:i.data.title||""}}return d}).filter(d=>d!==null)}s.length>0&&n.push({objects:s,id:e,title:c})}}),n},re={type:"tween",duration:.5,ease:[0,.71,.2,1.01]},He=()=>{const{message:r}=pt.useApp(),t=P.useRef(null),n=P.useRef(""),i=P.useRef(0),s=P.useRef([]),e=P.useRef(new Set),c=P.useRef(new Set),f=Y=>{var F,N;const X=((F=Y==null?void 0:Y.data)==null?void 0:F.title)||"",K=((N=Y==null?void 0:Y.data)==null?void 0:N.text)||"",T=JSON.stringify((Y==null?void 0:Y.data)||{});return`${Y.type}::${X}::${K}::${T}`},v=Y=>JSON.stringify(Y.objects||[]),a=P.useRef(null),[g,l]=P.useState(!1),{handleRedo:o,handleUndo:w}=xt(t.current,!1),{currentCanvasId:u,canvasList:y,outline:p,addCanvasByIndex:b,deleteCanvasById:A}=G(Xt(Y=>({currentCanvasId:Y.currentCanvasId,outline:Y.outline,canvasList:Y.canvasList,addCanvasByIndex:Y.addCanvasByIndex,deleteCanvasById:Y.deleteCanvasById}))),R=gt(),z=()=>{t.current&&Yt.handleSave(t.current)},d=()=>{var Y;(Y=t.current)==null||Y.clear(),z()},C=async Y=>{let X;if(g||!p)return;a.current&&a.current.abort(),a.current=new AbortController,l(!0),n.current="",i.current=0,e.current.clear(),c.current.clear(),s.current=[],G.setState({canvasList:[]});const K=await k();K&&(X=new Map([[S.Cover,[]],[S.ContentsZero,[]],[S.ContentsFive,[]],[S.ContentsSix,[]],[S.ContentsSeven,[]],[S.ContentsEight,[]],[S.ContentsFour,[]],[S.ContentsOne,[]],[S.ContentsThree,[]],[S.ContentsTwo,[]],[S.Transition,[]],[S.Contents,[]],[S.End,[]]]),K.forEach(T=>{var F;T&&T.title&&(X!=null&&X.has(T.title))&&((F=X==null?void 0:X.get(T.title))==null||F.push(JSON.stringify(T)))})),St({abortController:a.current,token:Lt,body:{response_mode:"streaming",query:G.getState().outline||"",inputs:{}},onMessage:T=>{const F=(T==null?void 0:T.answer)||"";n.current+=F;const N=n.current.slice(i.current);if(!N.trim())return;const{sections:E,rest:$}=Bt(N);if(E.length){for(const m of E){const O=nt(m);if(O.length){const J=O.filter(V=>{const Z=f(V);return e.current.has(Z)?!1:(e.current.add(Z),!0)});if(!J.length)continue;if(s.current.push(...J),t!=null&&t.current){const V=G.getState().canvasList,Z=[];for(const tt of J){let D=[];if(X?D=ht([tt],X):D=ft([tt],G.getState().template),D&&D.length){const et=D[0],it=v(et);c.current.has(it)||(c.current.add(it),Z.push(et))}}Z.length>0&&G.setState({canvasList:[...V,...Z],currentCanvasId:Z[Z.length-1].id})}}}i.current=n.current.length-$.length}},onClose:()=>{r.success("生成PPT完成"),l(!1),a.current=null;try{const T=n.current.slice(i.current);if(T.trim()){const F=nt(T);if(F.length){const N=F.filter(E=>{const $=f(E);return e.current.has($)?!1:(e.current.add($),!0)});if(N.length&&(s.current.push(...N),t!=null&&t.current)){const E=G.getState().canvasList,$=[];for(const m of N){let O=[];if(X?O=ht([m],X):O=ft([m],G.getState().template),O&&O.length){const J=O[0],V=v(J);c.current.has(V)||(c.current.add(V),$.push(J))}}$.length>0&&G.setState({canvasList:[...E,...$],currentCanvasId:$[$.length-1].id})}}}}catch{}},onError:()=>{l(!1),a.current=null}})},I=()=>{a.current&&a.current.abort(),l(!1),r.info("请求已取消"),a.current=null},k=async()=>{if(!(G.getState().template==="1"||G.getState().template==="2"))try{return await At.getTemplate(G.getState().template,"json")}catch{return[]}};return P.useEffect(()=>{var X;return((X=R.state)==null?void 0:X.shouldGenerate)&&p&&(C(),window.history.replaceState({},document.title)),()=>{a.current&&a.current.abort()}},[]),W.jsxs("main",{style:{minHeight:"800px",minWidth:"800px"},className:"flex h-screen w-full min-w-min flex-col items-center justify-start overflow-x-auto bg-white",children:[W.jsx("div",{className:"flex h-10 w-full items-center justify-between border-b px-[2px]",children:W.jsx(dt,{handleSave:z,handleClear:d,handleRedo:o,handleUndo:w,refCanvas:t,isTemplate:!1})}),W.jsx("div",{className:"h-20 w-full border-b border-gray-100",children:W.jsx(yt,{canvas:t.current,isTemplate:!1})}),W.jsxs("div",{className:"flex h-[calc(100vh-144px)] w-full min-w-[800px] overflow-auto",children:[W.jsx(vt.aside,{initial:{x:-180},animate:{x:0},transition:re,className:"h-full w-[180px] overflow-auto border-r border-gray-100",children:W.jsx(wt,{isDisplayTitle:!1,canvas:t.current,addCanvasByIndex:b,deleteCanvasById:A,currentCanvasId:u,canvasList:y,setCurrentCanvasId:Y=>{z(),G.setState({currentCanvasId:Y})}})}),W.jsx(Ht,{isTemplate:!1,handleSave:z,canvasList:y,ref:t,currentCanvasId:u})]}),W.jsx(bt,{}),g&&W.jsxs("div",{className:"absolute inset-0 z-50 flex size-full flex-col items-center justify-center gap-5 bg-gray-500/30",children:[W.jsx(zt,{className:"text-6xl text-[#eab308]"}),W.jsxs("div",{className:"flex flex-col items-center gap-3",children:[W.jsx("span",{className:"text-lg font-medium text-white",children:"正在生成中..."}),W.jsx(ut,{type:"default",onClick:I,children:"取消生成"})]})]})]})};export{He as default};
