import{f as R,r as u,A as E,j as t,B as g}from"./index-626914f7.js";import{u as n,v as N}from"./canvas-0ce26167.js";import{u as M}from"./shallow-960f8f40.js";import{g as B}from"./index-204389a5.js";import{t as d,P as a}from"./index-383ddd63.js";import"./index.esm-0b9baea5.js";const A="/assets/ppt1-4a4771c6.png",U="/assets/ppt2-4e911bc6.png",O=[{id:"1",name:"读书分享会模版",bg:A},{id:"2",name:"毕业论文模版",bg:U}],Z=()=>{const p=R(),[m,h]=u.useState(!1),[C,x]=u.useState([]),f=u.useRef(null),{message:o}=E.useApp(),{outline:z,template:b}=n(M(e=>({outline:e.outline,template:e.template}))),k=()=>{if(!n.getState().template){o.warning("请选择一个模板");return}f.current&&f.current.abort(),o.success("已选择模板，准备生成PPT"),p("/home",{state:{shouldGenerate:!0}})},S=async()=>{if(m){o.info("正在加载中");return}if(!n.getState().template){o.warning("请选择一个模板");return}h(!0);try{const e=await B(n.getState().outline),r=e==null?void 0:e.answer;if(!r){o.error("生成文本失败 请重试");return}const s=await fetch("http://192.168.61.20:3000/api/export-ppt",{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"helix"},body:JSON.stringify({id:n.getState().template,text:r})});if(!s.ok)throw new Error(`导出失败: ${s.status}`);const i=s.headers.get("content-disposition")||"",l=/filename\*?=(?:UTF-8''|")?([^\";]+)/i.exec(i),j=l?decodeURIComponent(l[1]):"index.pptx",P=await s.arrayBuffer(),L=new Blob([P],{type:"application/vnd.openxmlformats-officedocument.presentationml.presentation"}),y=URL.createObjectURL(L),c=document.createElement("a");c.href=y,c.download=j,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(y)}catch{}finally{h(!1)}},v=async()=>{try{const r=(await d.getProjectTemplates("bg")).map(s=>({...s.data,id:s.itemKey}));x(r)}catch{x([])}},T=async e=>{try{(await Promise.allSettled([d.deleteTemplate("bg",e),d.removeProject(e)])).some(i=>i.status==="fulfilled")?(o.success("删除成功"),v()):o.error("删除失败")}catch{o.error("删除失败")}},w=async e=>{if(m){o.warning("正在加载中，请稍等");return}if(e)try{const r=await d.getTemplate("bg",e),s=await d.getTemplate(e,"json");if(r&&s){const i=s.map(l=>[a.ContentsZero,a.ContentsOne,a.ContentsTwo,a.ContentsThree,a.ContentsFour,a.ContentsFive,a.ContentsSix,a.ContentsSeven,a.ContentsEight].includes(l.title)?{...l,title:a.Content}:l);n.setState({canvasList:i,currentCanvasId:i[0].id,pptName:r.name??"默认模版"})}}catch{o.error("没有模板数据 请稍后再试");return}else{const r=N();n.setState({canvasList:[{id:r,title:a.Cover,objects:[]}],currentCanvasId:r,pptName:"默认模版"})}p(`/createTemplate?id=${e||N()}`)};return u.useEffect(()=>{v()},[]),t.jsxs("div",{className:"flex size-full flex-col items-center bg-gray-50",children:[t.jsx("div",{className:"flex w-full items-center justify-center border-b bg-white py-2",children:t.jsxs("div",{className:"flex w-full max-w-5xl items-center justify-between gap-2",children:[t.jsx(g,{onClick:()=>p("/outline"),className:"flex items-center rounded-md",children:"返回大纲"}),t.jsx("span",{className:"text-lg font-semibold",children:"PPT模版"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(g,{onClick:S,loading:m,className:"flex items-center rounded-md",children:m?"正在导出PPT...":"直接导出PPT"}),t.jsx(g,{type:"primary",onClick:k,className:"flex items-center rounded-md",children:"立即生成"})]})]})}),t.jsxs("div",{className:"grid w-full max-w-5xl grid-cols-1 gap-6 p-4 sm:grid-cols-2 lg:grid-cols-3",children:[O.map((e,r)=>t.jsxs("div",{className:`group relative flex cursor-pointer flex-col overflow-hidden rounded-md border-2 bg-white transition-all duration-200 ${b===e.id.toString()?"border-primary shadow-2xl":"border-transparent"}`,onClick:()=>{n.setState({template:e==null?void 0:e.id.toString()})},children:[t.jsx("img",{src:e==null?void 0:e.bg,alt:e==null?void 0:e.name,className:"h-[220px] w-full object-cover",draggable:!1}),t.jsx("div",{className:"pointer-events-none absolute left-0 top-0 flex h-full w-full flex-col items-center justify-center bg-black/10"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/60 to-transparent p-4",children:t.jsx("div",{className:"mb-1 text-lg font-bold text-white drop-shadow",children:e.name})})]},r)),C.map((e,r)=>t.jsxs("div",{className:`group relative flex cursor-pointer flex-col overflow-hidden rounded-md border-2 bg-white transition-all duration-200 ${b===e.id.toString()?"border-primary shadow-2xl":"border-transparent"}`,onClick:()=>{n.setState({template:e==null?void 0:e.id.toString()})},children:[t.jsx("img",{src:e==null?void 0:e.bg,alt:e==null?void 0:e.name,className:"h-[220px] w-full object-cover",draggable:!1}),t.jsx("div",{className:"pointer-events-none absolute left-0 top-0 flex h-full w-full flex-col items-center justify-center bg-black/10"}),t.jsx("div",{className:"absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/60 to-transparent p-4",children:t.jsx("div",{className:"mb-1 text-lg font-bold text-white drop-shadow",children:e.name})}),t.jsx("button",{onClick:s=>{s.stopPropagation(),T(e.id.toString())},"aria-label":"删除",className:"absolute right-2 top-2 z-10 flex h-8 w-8 items-center justify-center rounded-md bg-white text-gray-500 opacity-0 shadow-md transition-all duration-200 hover:bg-gray-100 group-hover:opacity-100",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[t.jsx("polyline",{points:"3 6 5 6 21 6"}),t.jsx("path",{d:"M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"}),t.jsx("path",{d:"M10 11v6"}),t.jsx("path",{d:"M14 11v6"}),t.jsx("path",{d:"M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"})]})}),t.jsx("button",{onClick:s=>{s.stopPropagation(),w(e.id.toString())},"aria-label":"编辑",className:"absolute right-12 top-2 z-10 flex h-8 w-8 items-center justify-center rounded-md bg-white text-gray-500 opacity-0 shadow-md transition-all duration-200 hover:bg-gray-100 group-hover:opacity-100",children:t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4",children:[t.jsx("path",{d:"M12 20h9"}),t.jsx("path",{d:"M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"})]})})]},r)),t.jsxs("div",{className:"group relative flex h-[220px] cursor-pointer flex-col overflow-hidden rounded-md border-2 border-dashed border-gray-300 bg-gradient-to-br from-gray-50 to-gray-100 transition-all duration-300 hover:scale-105 hover:border-primary hover:shadow-lg",onClick:()=>w(),children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-50/50 to-purple-50/50 opacity-0 transition-opacity duration-300 group-hover:opacity-100"}),t.jsxs("div",{className:"relative z-10 flex h-full flex-col items-center justify-center",children:[t.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-md bg-primary/10 transition-all duration-300 group-hover:scale-110 group-hover:bg-primary/20",children:t.jsx("svg",{className:"h-8 w-8 text-primary transition-colors duration-300 group-hover:text-primary/80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-lg font-semibold text-gray-700 transition-colors duration-300 group-hover:text-primary",children:"创建新模板"}),t.jsx("div",{className:"mt-1 text-sm text-gray-500 transition-colors duration-300 group-hover:text-gray-600",children:"设计你的专属PPT模板"})]})]})]})]})]})};export{Z as default};
